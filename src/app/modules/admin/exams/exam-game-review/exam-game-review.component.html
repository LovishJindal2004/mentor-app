<div class="card-wrapper w-full bg-white game-review">
    <!-- mat expension starts-->
    <div class="accordian-outer game-review">
        <app-exam-game-header [examType]="examDetails.testCategory" [Examtitle]="examDetails.name" [isfromMarksheet]="true"
            [hideinstructions]="true" [hidetracker]="true" [examType]="examDetails.testCategory" [Examtitle]="examDetails.name" (dataEvent)="receiveDataFromHeader($event,true)"></app-exam-game-header>
        <!-- <div class="flex items-center justify-center mt-30" *ngIf="dataLoaded">
            <img src="../../../../../assets/images/logo/imgLoder.gif" class="w-15">
        </div> -->
        <div class="flex relative">

            <!-- <div class="flex items-center gap-2.5 h-13  bg-white pt-1 pb-1 pl-[99px] shadow" *ngIf="QuestionId>0">

                <mat-icon class="ml-6 text-primary cursor-pointer" (click)="Goback()">keyboard_backspace</mat-icon>
                <h2 class="text-[14px] text-[#6E6E6E] font-medium cursor-pointer"><span class="text-primary"
                        (click)="Goback()">Back</span> / {{examDetails.name}}</h2>

            </div> -->
            <div class="py-4 pb-10 pt-0 mb-10 header-tabs" [ngClass]=" isviewtrackboard ? 'sevenper' : 'w-full'">
                <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="center"
                    (selectedTabChange)="getpartWiseQuestions($event)" [selectedIndex]="tabindex"> 
                    <mat-tab *ngFor="let part of partDetails;let i=index"> <ng-template mat-tab-label>
                            <span>{{part.name}}</span>
                            <mat-icon class="text-base">info</mat-icon>

                        </ng-template>

                        <div class="flex  justify-between">
                            <h2 class="text-[#505050] text-base">Question
                                :{{indexToFilter+1}}/{{questionDetails?.length}}</h2>
                            <div class="flex gap-2">
                                <mat-slide-toggle class="slide-toggle" color="primary" (click)="setExplanation()">{{IsDefaultExplanation==false?'Default Explanation':'choice Based Explanation'}}
                                </mat-slide-toggle>
                                <!-- <div class="flex justify-end bookmarks" *ngIf="!practiceMode">
                                    <mat-icon *ngIf="!FilterQuestionData[0]?.isBookMarked"
                                        class="text-primary cursor-pointer"
                                        (click)="BookmarkQuestions(FilterQuestionData,false)">bookmark_border</mat-icon>
                                    <mat-icon *ngIf="FilterQuestionData[0]?.isBookMarked"
                                        class="text-primary cursor-pointer"
                                        (click)="BookmarkQuestions(FilterQuestionData,true)">bookmark</mat-icon>
                                </div> -->
                            </div>
                        </div>
                        <hr class="my-4 border-primary-100">
                        <div class="bg-white">
                            <div class="font-medium question" [innerHTML]="sanitizeExplanationContent(FilterQuestionData[0]?.questionTitle)">
                            </div>
                        </div>
                        <div class="expension_div rounded ">
                            <h6 class="mt-3.5 font-light">Select option any one</h6>
                            <div *ngFor="let choice of  FilterQuestionData[0]?.choices ;let i = index;">
                                <h6 class="mt-3.5 font-medium text-[#28C397]" *ngIf="choice.isCorrect">Correct Answer
                                </h6>
                                <div class="bg-white choices mt-3.5 flex p-2.5"
                                    [ngClass]="{' wrong-choice relative': choice.isChecked,' correct-choice': choice.isCorrect}">
                                    <span
                                        class="content-center mr-2.5 border border-[#DCDCDC] text-sm px-1 h-5 w-5 rounded"><B>{{i+1}}</B></span>
                                    <h2 class="font-medium" [innerHTML]="choice.choiceText"></h2>
                                    <mat-icon class="bg-[#EA4435] rounded-full text-base text-white absolute right-4"
                                        *ngIf="choice.isChecked && !choice.isCorrect" matTooltip="you select this Wrong">close</mat-icon>
                                    <mat-icon class="mulichoiesWrng"
                                        matTooltip="This Choies is correct but you don't select"
                                        *ngIf="FilterQuestionData[0]?.questionType==2 && !choice.isChecked && choice.isCorrect ">error</mat-icon>
                                        <mat-icon class="rounded-full  text-green-600 absolute right-4 text-2xl" *ngIf="choice.isChecked && choice.isCorrect" matTooltip="you select this right">done</mat-icon>
                                </div>
                                <h5 class="text-sm font-medium mt-2" *ngIf="!practiceMode && !choice.isChecked && !choice.isCorrect && choice.pollCount !== null">
                                    {{ (getTotalUsers(this.FilterQuestionData[0]) > 0 ? (choice.pollCount / getTotalUsers(this.FilterQuestionData[0])) * 100  : 0) | number:'1.2-2'}}%
                                     marked this Wrong</h5>
                                <h5 class="text-sm font-medium mt-2" *ngIf="!practiceMode && choice.isChecked && !choice.isCorrect && choice.pollCount !== null">
                                    {{ (getTotalUsers(this.FilterQuestionData[0]) > 0 ? (choice.pollCount / getTotalUsers(this.FilterQuestionData[0])) * 100  : 0) | number:'1.2-2'}}%
                                     marked this Wrong</h5>
                                <h5 class="text-sm font-medium mt-2" *ngIf="!practiceMode && choice.isCorrect || (choice.isChecked && choice.isCorrect) && choice.pollCount !== null">
                                    {{ (getTotalUsers(this.FilterQuestionData[0]) > 0 ? (choice.pollCount / getTotalUsers(this.FilterQuestionData[0])) * 100  : 0) | number:'1.2-2'}}%
                                       got this correct</h5>
                                <!-- <h5 class="text-sm font-medium mt-2" *ngIf="choice.isChecked && !choice.isCorrect ">
                                    {{choice.percentageOfUserSelectedThisOption==null
                                    ?'0':choice.percentageOfUserSelectedThisOption | number: '1.2-2'}}% marked this
                                    Wrong</h5>
                                <h5 class="text-sm font-medium mt-2"
                                    *ngIf="choice.isCorrect || (choice.isChecked && choice.isCorrect)">
                                    {{choice.percentageOfUserSelectedThisOption==null
                                    ?'0':choice.percentageOfUserSelectedThisOption | number: '1.2-2'}}% got this correct
                                </h5> -->
                            </div>
                            <!-- <p class=" mt-3.5 font-bold text-base" *ngIf="currentQuestionDetail.tags?.length>0">*Tags</p>
                        <mat-chip-list aria-label="Tags" *ngFor="let tag of currentQuestionDetail.tags">
                            <mat-chip class="text-primary font-normal border-inherit bg-primary/20 mt-3.5">{{tag.name}}</mat-chip>
    
                        </mat-chip-list>
                        <hr class="h-px my-8 border-primary/25"> -->

                            <h3 class="mt-3.5 text-primary font-normal text-lg">
                                Solutions</h3>
                            <div>
                                <!-- <ng-container>
    
                                <h4 class="font-bold text-base mt-3.5">Explanation</h4>
                                <p class="mt-3.5 font-medium explanation" [innerHTML]="FilterQuestionData[0]?.explanation">
                                </p>
                            </ng-container> -->
                            <ng-container *ngIf="currentQuestionDetail.explanations?.length === 2">
                                <!-- Display the explanation based on IsDefaultExplanation -->
                                
                                <h4 class="font-bold text-base mt-3.5" *ngIf="IsDefaultExplanation && currentQuestionDetail.explanations[0]?.content" >Choised Based Explanation </h4>
                                <p class="mt-3.5 font-medium explanation" *ngIf="IsDefaultExplanation && currentQuestionDetail.explanations[0]?.content" [innerHTML]="sanitizeExplanationContent(currentQuestionDetail.explanations[0]?.content)"></p>
                            
                                <h4 class="font-bold text-base mt-3.5" *ngIf="!IsDefaultExplanation && currentQuestionDetail.explanations[1]?.content">Correct Answer </h4>
                                <p class="mt-3.5 font-medium explanation" *ngIf="!IsDefaultExplanation && currentQuestionDetail.explanations[1]?.content" [innerHTML]="sanitizeExplanationContent(currentQuestionDetail.explanations[1]?.content)"></p>
                              </ng-container>
                            </div>
                            <h4 class="font-bold text-base mt-3.5 " *ngIf="currentQuestionDetail.videos?.length>0">
                                *Related Video Link</h4>
                            <p class="mt-3.5 font-medium text-primary"
                                *ngFor="let video of currentQuestionDetail.videos">
                                {{video.videoLink }}
                            </p>
                            <h4 class="font-bold text-base mt-3.5 " *ngIf="currentQuestionDetail.books?.length>0">
                                *Reference Books
                            </h4>
                            <p class="mt-3.5 font-medium " *ngFor="let book of currentQuestionDetail.books,let i=index">
                                {{book.title}}, {{book.edition}}, {{book.pageNumber}}</p>
                                <h4 class=" mt-3.5 text-primary font-normal text-lg" *ngIf="currentQuestionDetail?.notes?.length>0">Notes </h4>
                                <p class="mt-3.5 font-medium explanation"  [innerHTML]="sanitizeExplanationContent(currentQuestionDetail?.notes)" *ngIf="currentQuestionDetail?.notes?.length>0"></p>
                            <h4 class="font-bold text-base mt-3.5 ">Question ID :
                                {{currentQuestionDetail.questionDetailID}}
                            </h4>
                            <div class="text-center mt-5 create-question-btn flex justify-center">
                                <button
                                    class="btn text-center text-lg bg-white font-medium p-4 mb-1.5 w-40 my-2 text-primary border-primary border rounded-lg Approved_btn"
                                    (click)="previousQuestion()">Previous</button>
                                <button
                                    class="btn text-center text-lg bg-primary font-normal p-4 mb-1.5 w-40 my-2 text-white rounded-lg next-btn"
                                    (click)="NextQuestion()">Next</button>
                                <!-- <button
                                    class="btn text-center text-lg bg-primary font-normal p-4 mb-1.5 w-46 my-2 text-white rounded-lg reportQuestion flex items-center justify-center"
                                    (click)="reportQuestion()"><mat-icon class="text-white">report</mat-icon> Report
                                    Question</button> -->
                            </div>
                        </div>
                    </mat-tab>

                </mat-tab-group>


            </div>
            <div class="serial_listing pt-4 pl-2 border-l-2 border-primary" *ngIf="isviewtrackboard">
                <div>
                    <h2 class="text-lg text-[#505050] font-medium">Part {{partIndex+1}} : Question Panel</h2>
                </div>
                <div class="mt-2 p-2 border border-primary-200 mt-2 tags">
                    <div class="grid grid-cols-4 mb-2 gap-1">
                        <div class="">
                            <div class="mx-auto clip-design bg-[#28C397]">
                                <div class="text-sm text-white mx-auto text-center">
                                    {{noOfCorrectAnswerd}}
                                </div>

                            </div>
                            <p class="text-[10px] text-[#505050] text-center"> correct</p>
                        </div>
                        <div class="">
                            <div
                                class="mx-auto w-[30px] min-h-[30px] rounded-full bg-[#E1A606]  flex items-center">
                                <div class="text-sm text-white mx-auto text-center">
                                    {{noOfmissedQuestion}}
                                </div>
                            </div>
                            <p class="text-[10px] text-[#505050] text-center">Missed</p>
                        </div>
                        <div class="">
                            <div class="mx-auto clip-design bg-[#FF0000] rotate-180">
                                <div class="text-sm text-white rotate-180 mx-auto text-center">
                                    {{noOfInCorrectAnswerd}}
                                </div>
                            </div>
                            <p class="text-[10px] text-[#505050] text-center">InCorrect</p>
                        </div>
                        <div class="">
                            <div
                                class="mx-auto w-[30px] min-h-[30px] rounded bg-[#F0F0F0] flex items-center">
                                <div class="text-sm text-black mx-auto text-center">
                                    {{noOfunAttmptQuestion}}
                                </div>
                            </div>
                            <p class="text-[10px] text-[#505050] text-center">UnAttempt</p>
                        </div>
                    
                    </div>
                    <!-- <div class="grid grid-cols-3 flex gap-1 second-grid">
                        <div class="flex gap-2 col-span-2">
                            <div
                                class="reviewed w-[30px] min-h-[30px] max-h-[30px] rounded-full bg-primary flex items-center">
                                <div class="text-sm text-white mx-auto text-center">
                                    {{answerdandMarkedforReview}}
                                </div>
                            </div>
                            <p class="text-[10px] text-[#505050]">Answered & Marked for review<br>
                                <span class="text-[8px]">(Will not be considered for evaluation)</span>
                            </p>
                        </div>
                        <div class="flex gap-2">
                            <div
                                class="w-[30px] min-h-[30px] max-h-[30px] rounded-full bg-[#E1A606] flex items-center">
                                <div class="text-sm text-white mx-auto text-center">
                                    {{noOfCrisk}}
                                </div>
                            </div>
                            <p class="text-[10px] text-[#505050]">Calculate Risk</p>
                        </div> 

                    </div> -->

                </div>
                <div class="flex grid grid-cols-5 mt-4 gap-3 question-listing">
                    <div *ngFor="let question of questionDetails;let i=index" (click)="gotoQuestion(i)"
                        [ngClass]="getQuestionClasses(question)">
                        <div class="py-4 rounded text-center cursor-pointer  text-sm"
                            [ngClass]="{'text-white': question.isChecked || !question.isChecked , 'text-black': question.unAttempt}">
                            {{i+1}}
                        </div>
                    </div>
              
                </div>
                <button class="text-center submit-btn text-white text-lg flex justify-center mt-3 w-[200px] p-4 mx-auto" (click)="!isQuestionSubmithaserror && receiveDataFromHeader('',false)">Submit</button>
            </div>

            <div class="flex items-center mr-2.5 right-popup"
                [ngClass]="isviewtrackboard  ? 'hide-popup' : 'show-popup'">
                <div *ngIf="isviewtrackboard" class="hide-panel cursor-pointer" (click)="trackQuestion()">
                    <span class="text-white font-normal">Hide Panel</span>
                    <mat-icon class="cursor-pointer text-white">keyboard_arrow_down</mat-icon>
                </div>
                <div *ngIf="!isviewtrackboard" class="show-panel cursor-pointer" (click)="trackQuestion()">
                    <span class="text-white font-normal">Show Panel</span>
                    <mat-icon class="cursor-pointer text-white">keyboard_arrow_up</mat-icon>
                </div>


            </div>
        </div>
    </div>
</div>
<ng-template #myDialog class="w-94">
    <section class="serial_listing p-6">
        <div>
            <div class="flex justify-between items-center">
                <h2 class="text-lg font-bold text-[#505050]">Summary</h2>
                <mat-icon class="text-[#BBBBBB] cursor-pointer" (click)="closedialog()">close</mat-icon>
            </div>

            <hr class="my-2">
            <h3 class="text-lg font-medium text-[#505050] w-80 wd-auto" [innerHTML]="examDetails.description"></h3>
            <h4 class="mt-4 font-light text-sm">{{noOfCorrectAnswerd+noOfInCorrectAnswerd}} /
                {{questionDetails?.length}} MCQ'S</h4>
        </div>
        <div class="mt-2 p-2 rounded border border-[#DCDCDC]">
            <div class="grid grid-cols-4 mt-4 mb-2 ggrid-cols-2">
                <div class="flex flex-col gap-1 items-center text-3xl text-[#28C397] font-bold leading-4 mx-auto">
                    <h4>{{noOfCorrectAnswerd}}</h4>
                    <h5 class="text-sm font-medium">Correct</h5>
                </div>
                <div class="flex flex-col gap-1 items-center text-3xl text-[#E1A606] font-bold leading-4 mx-auto">
                    <h4>{{noOfmissedQuestion}}</h4>
                    <h5 class="text-sm font-medium">Missed</h5>
                </div>
                <div class="flex flex-col gap-1 items-center text-3xl text-[#EA4435] font-bold leading-4 mx-auto">
                    <h4>{{noOfInCorrectAnswerd}}</h4>
                    <h5 class="text-sm font-medium">InCorrect</h5>
                </div>
                <div class="flex flex-col gap-1 items-center text-3xl text-[#505050] font-bold leading-4 mx-auto">
                    <h4>{{noOfunAttmptQuestion}}</h4>
                    <h5 class="text-sm font-medium">Un attempt</h5>
                </div>
                <!-- <div class="flex flex-col gap-1 items-center text-3xl text-[#ff006c] font-bold leading-4 mx-auto">
                    <h4>{{NoofCRisk}}</h4>
                    <h5 class="text-sm font-medium">CRisk</h5>
                </div> -->
                <!-- <div class="flex flex-col gap-1 items-center text-3xl text-[#e447dd] font-bold leading-4 mx-auto">
                    <h4>{{NoofMarkedQuestion}}</h4>
                    <h5 class="text-sm font-medium">Marked</h5>
                </div> -->
            </div>
        </div>
        <div class="flex grid grid-cols-5 mt-4 gap-3 question-list">
            <div class="border py-3 rounded text-center" *ngFor="let question of questionDetails;let i=index"
                (click)="gotoQuestion(i)" [ngClass]="getQuestionClasses(question)">{{i+1}}</div>
        </div>

    </section>
</ng-template>
<ng-template #myDialog2 class="w-94">
    <section class="pt-4 w-80 p-8 pb-0">
        <h2 class="text-center text-[#505050] max-w-48 mx-auto text-xl font-medium">Are you sure want to exit the Q'Bank
        </h2>
        <h3 class="text-[#6E6E6E] text-center text-sm mt-2">QBank ID : ADrQBANK002</h3>
        <button mat-raised-button class="w-full bg-[#0C529A] text-[#FFFFFF] text-xl py-2 mt-4 rounded-md">No, let me
            continue</button><br>
        <button mat-raised-button
            class="w-full bg-[#EB5B5B] text-[#FFFFFF] text-xl mt-2 session_expire h-24 rounded-md">Pause now<br>
            <span class="text-sm">Session expired on 3 Min</span></button>
    </section>
    <div class="bg-[#DCDCDC] text-center mt-6">
        <button class="text-lg text-[#505050] py-4 font-medium w-full" [mat-dialog-close]="true"
            (click)="closedialog()">Exit</button>
    </div>
</ng-template>
<ng-template #ReportQuestion class="w-280">
    <div class="flex justify-between px-4 py-4 border-b">
        <h2 class="text-[#505050] text-lg">Report Question</h2>
        <mat-icon class="cursor-pointer" (click)="closedialog()">close</mat-icon>
    </div>
    <div class="pt-4 px-4 py-4">
        <form #form="ngForm" (ngSubmit)="SubmitReport(form)">
          <h2 class="text-[#505050] text-base font-medium pb-1">Where do you feel we are wrong?</h2>
          <mat-checkbox name="errorTypeQuestion" value="Question has error" ngModel class="example-margin w-full">Question has error</mat-checkbox>
          <mat-checkbox name="errorTypeOption" value="Option has error" ngModel class="example-margin w-full">Option has error</mat-checkbox>
          <mat-checkbox name="errorTypeExplanation" value="Explanation has error" ngModel class="example-margin w-full">Explanation has error</mat-checkbox>
          
          <h5 class="text-[#6E6E6E] text-base font-medium text-center pt-2 mt-2">
            Please fill in the reason why we are wrong (we would like to hear your feedback so we can correct if we are wrong)
          </h5>
      
          <mat-form-field class="w-full report-questions">
            <textarea matInput name="feedback" ngModel class="border border-primary/10 text-left"
                      placeholder="Do tell Us Why you feel it's Wrong (min 20 chars)" required></textarea>
          </mat-form-field>
      
          <button mat-raised-button type="submit" class="write-review-btn text-lg mt-2 h-12 font-normal text-white" [disabled]="form.invalid">
            Submit
          </button>
        </form>
      </div>
</ng-template>